@page "/transactions/invoices/{studentId}"
@layout EmptyLayout
@inject NavigationManager navigationManager;
@using wsmcbl.front.Models.Accounting


<link rel="stylesheet" href="/css/Factura.css" />

@if (studentId == null)
{
    <a> Loading... </a>
}else
{
    <div class="factura">
    <h5 class="izqC">Colegio Bautista Libertad</h5>
    <p class="direccion">Entrada Norte C.C.Managua, 1c. E. 1c S. 1/2c-E.</p>
    <p>Telefono: 22705587</p>

    <p class="izqC">Recibo de Caja</p>
    <hr> 

    <div class="row">
        <div class="col">
            <p class="izqN">Recibo N°</p>
            <p class="izqN">Cod. Estu</p>
            <p class="izqN">Fecha</p>
        </div>
        <div class="col">
            <p class="izq">@invoice.TransactionId</p>
            <p class="izq">@invoice.StudentId</p>
            <p class="izq">@invoice.DateTime</p>
        </div>
    </div>

    <p class="der">A nombre de: </p>
    <p class="izqC">@invoice.StudentName</p>

    <blockquote class="izqC">DETALLE</blockquote>

        <table>
            <thead>
                <tr>
                    <th>Concepto</th>
                    <th>Monto</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in invoice.Tariffs)
                {
                    <tr>
                        <td> @item.Concept </td>
                        <td> @item.Amount </td>
                    </tr>
                }
            </tbody>
        </table>
    <hr>
    

    <div class="row">
        <div class="col">
            <p class="izqN">T. Bruto:</p>
            <p class="izqN">Descuento:</p>
        </div>
        <div class="col">
            <p class="izq">C$ @invoice.Total</p>
            <p class="izq">@invoice.Discount</p>
        </div>
    </div>
    <hr>

    <div class="row">
        <div class="col">
            <p class="izqN">T Neto:</p>
        </div>
        <div class="col">
            <p class="izq">C$ 1,300.00</p>
        </div>
    </div>
    <hr>
    <br>

    

    <div class="row">
        <div class="col">
            <hr>
            <p>Cliente</p>
        </div>
        <div class="col">
            <hr>
            <p>Administrador</p>
        </div>
    </div>
    <br>

    <hr>
    <div class="row">
        <div class="col">
            <p class="izqN">Balance General</p>
        </div>
        <div class="col">
            <p class="izq">5,600.00</p>
        </div>
    </div>
    <p class="end">NO ES VALIDO SIN FIRMA NI SELLO DEL CAJERO</p>
</div>
}

@code {

    InvoiceDto invoice;
    List<Tariff> tariffs;

    [Parameter]
    public string studentId {get; set; }   

    protected override void OnInitialized()
    {        
        //obtenemos el Id del estudiante y su informacion completa
        var segments = navigationManager.ToAbsoluteUri(navigationManager.Uri).Segments;
        studentId = segments.Last().Trim('/'); // Para asegurarte de quitar cualquier barra adicional al final

        
        tariffs = new List<Tariff>
        {
            new Tariff(1, "Tarifa 1", 20.0),
            new Tariff(2, "Tarifa 2", 30.0),
            new Tariff(3, "Tarifa 3", 40.0)
        };

        // Crear un objeto InvoiceDto
        invoice = new InvoiceDto(
            "12345",                     // transactionId
            "Cajero 1",                  // cashierName
            "S123",                      // studentId
            "Juan Pérez",                // studentName
            90.0,                        // total
            10.0,                        // discount
            1,                           // areals
            DateTime.Now,                // dateTime
            tariffs                      // tariffs
        );
    }


}


<script src="/js/Facture.js" defer></script> 




